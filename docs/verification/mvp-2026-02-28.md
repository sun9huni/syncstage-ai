# MVP Verification Log (2026-02-28)

본 문서는 SyncStage AI MVP의 핵심 기능 및 보안/회복력에 대한 검증 결과를 기록합니다. 
이 문서를 기반으로 회귀(Regression)를 방지하고 다음 단계 개발의 기반으로 삼습니다.

## 1. 기능 검증 (Functional Validation)
- [x] **오디오 업로드 파이프라인:** `.mp3` 업로드 시 Gemini Files API로 정상 전송되며, `PROCESSING` 상태 대기 루프가 정상 동작함. (`/api/draft`)
- [x] **초안(Draft) 생성:** Gemini 3.1 Pro가 `SyncStageDraftSchema` (Zod) 규격에 정확히 맞는 JSON을 반환함. 
- [x] **타임라인 연동:** 생성된 Draft가 프론트엔드로 전달되어 `WaveformTimeline` 플러그인에 `Region`으로 시각화됨.
- [x] **도메인 액션(Patch):** 자연어 입력 시 `/api/patch`가 Function Calling(`update_segment`, `update_style`)을 정확히 타겟팅하여 부분 업데이트 수행. 
- [x] **리비전(Revision) 추적:** 패치가 성공할 때마다 `revision` 번호가 증가하고, 프론트엔드 헤더에 즉각 반영됨.

## 2. 회복력 / 에러 처리 (Resilience & Error Handling)
- [x] **파일 누락 예외 처리:** 오디오 파일 없이 `/api/draft` 호출 시 HTTP `400` 반환 확인.
- [x] **JSON 파싱 실패 방지:** `gemini-3.1-pro-preview`에서 `responseMimeType: "application/json"` 최적화를 통해 파싱 에러 방지.
- [x] **데이터 충돌 (Idempotency):** 클라이언트가 잘못된 `revision` 번호로 패치를 요청하면 HTTP `409 Conflict`를 의도적으로 발생시켜 데이터 무결성 보호.

## 3. 보안 / 환경 설정 (Security & Config)
- [x] `.env.local` 파일이 최상위에 분리되어 있으며 `GEMINI_API_KEY`가 클라이언트 번들(Browser)에 노출되지 않음을 보장. (`NEXT_PUBLIC_` 접두사 사용 안 함)
- [x] 처리 완료된 임시 파일(Temp File)이 로컬 파일 시스템에서 즉시 `unlink` 되어 디스크 용량 누수 방지.

## 다음 단계 조치사항
* 프론트엔드에서 `409 Conflict` 발생 시 에러 토스트(Toast)를 띄우고 자동으로 `/api/state`를 재호출(Refetch)하는 로직 추가 필요.
